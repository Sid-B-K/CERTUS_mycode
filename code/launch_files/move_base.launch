<launch>

  <!-- Start move_base -->
  <node pkg="move_base" type="move_base" name="move_base" output="screen">
    <!-- Load planner and costmap parameters -->
    <rosparam file="$(find sd_robot)/config/costmap_common_params.yaml" command="load" />
    <rosparam file="$(find sd_robot)/config/local_costmap_params.yaml" command="load" />
    <rosparam file="$(find sd_robot)/config/global_costmap_params.yaml" command="load" />
    <rosparam file="$(find sd_robot)/config/base_local_planner_params.yaml" command="load" />

    <!-- Remap goal topic to RViz-compatible topic -->
    <remap from="goal" to="/move_base_simple/goal" />
  </node>

  <!-- Start AMCL for localization -->
  <include file="$(find sd_robot)/launch/amcl.launch" />

  <!-- Convert PointCloud2 to LaserScan -->
  <node pkg="pointcloud_to_laserscan" type="pointcloud_to_laserscan_node" name="pointcloud_to_laserscan" output="screen">
    <param name="target_frame" value="base_link"/>
    <param name="min_height" value="-1.0"/>
    <param name="max_height" value="1.0"/>
    <param name="angle_min" value="-3.14"/>
    <param name="angle_max" value="3.14"/>
    <param name="angle_increment" value="0.0058"/>
    <param name="range_min" value="0.1"/>
    <param name="range_max" value="30.0"/>
    <param name="scan_time" value="0.1"/>

    <remap from="cloud_in" to="/points_raw"/>
    <remap from="scan" to="/scan"/>
  </node>

  <!-- Static transform: map -> odom -->
  <node pkg="tf" type="static_transform_publisher" name="map_to_odom_broadcaster"
        args="0 0 0 0 0 0 map odom 100" />

  <!-- Static transform: odom -> base_link (if not already provided) -->
  <node pkg="tf" type="static_transform_publisher" name="odom_to_base_link_broadcaster"
        args="0 0 0 0 0 0 odom base_link 100" />

</launch>
